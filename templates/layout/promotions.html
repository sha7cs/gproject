{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% block title%} Promotions {% endblock %}

{% block content %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Della+Respira&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{% static 'chat/chat.css' %}">
<main role="main" class="main-content">
  <div class="container-fluid">
    <div class="row justify-content-center">
      <div class="col-12">
        <h1 class="page-title">{% trans 'Promotions Page' %}</h1>
        <div class="row">

<!-- First column: Marketing Advice -->
<div class="col-md-4">
  <div class="row">
      <div class="col-12 mb-3">
          <div class="card-big-shadow">
              <div class="card card-just-text" data-background="color" data-color="green" data-radius="none">
                  <div class="content" style="padding: 10; height: 100%; display: flex; flex-direction: column; text-align: center;">
                      <h6 class="category della-respira-regular mb-3">Your Daily Marketing Advice</h6>
                      <div style="flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                          <span style="font-weight: bold; margin-bottom: 10px; font-size: 24px;">{{ advice.title }}</span>
                          <span>{{ advice.advice }}</span>
                      </div>
                  </div>
              </div>
          </div>
      </div>

      <!-- ✅ Best Time to Promote (Based on Sales Analysis) -->
      <div class="col-12 mb-3">
          <div class="card-big-shadow">
              <div class="card card-just-text" data-background="color" data-color="pink" data-radius="none">
                  <div class="content">
                      <h6 class="category mb-3">{% trans 'Best Days to Promote' %}</h6>
                      <h4 class="title mb-3">{{ best_time }}</h4>
                      <p class="description">{% trans 'The best days for promotions based on sales trends.' %}</p>
                  </div>
              </div>
          </div>
      </div>
  </div>
</div>

<!-- Second column: Upcoming Event -->
<div class="col-md-4">
  <div class="row">
   <div class="col-12 mb-3">
    <div class="card-big-shadow">
        <div class="card card-just-text" data-background="color" data-color="bluesh" data-radius="none">
            <div class="content" style="text-align: center;">
                <h6 class="category mb-3">{% trans 'Upcoming Event' %}</h6>
                {% if next_event %}
                    <h4 class="title mb-3">{{ next_event.event_name }}</h4>
                    <p class="description">
                        {% trans 'Date:' %} <strong>{{ next_event.event_date }}</strong><br>
                        {% trans 'Days Remaining:' %} <strong>{{ next_event.days_remaining }}</strong>
                    </p>
                {% else %}
                    <p class="description">{% trans 'No upcoming events.' %}</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>


      <!-- ✅ Which Product to Discount (Based on Low Sales) -->
      <div class="col-12 mb-3">
          <div class="card-big-shadow">
              <div class="card card-just-text" data-background="color" data-color="gray-brown" data-radius="none">
                  <div class="content">
                      <h6 class="category mb-3">{% trans 'Which Product to Discount' %}</h6>
                      <h4 class="title mb-3">{{ best_product }}</h4>
                      <p class="description">{% trans 'This product has the lowest sales and could benefit from a discount.' %}</p>
                  </div>
              </div>
          </div>
      </div>
  </div>
</div>

<!-- Third column: Chatbot -->
<div class="col-md-4">
  <div class="chat-container">
      <!-- Cover Section -->
      <div class="cover-container" id="cover-container">
          <div class="custom-cover">
              <h2>{% trans 'Welcome to the Chat' %}</h2>
              <p>{% trans 'Click below to start' %}</p>
              <img src="{% static 'chat/images/robot.png'%}" alt="Robot" class="robot-image" />
              <button class="custom-card-button cover" onclick="startChat()">{% trans 'start chat' %}</button>
          </div>
      </div>

      <!-- Chat Content -->
      <div class='my-auto flex-column text-center' id="chat-content" style="display: none;">
          <h2 class="text-center" id="categoryTitle">{% trans 'select category' %}</h2>
          <div class="d-flex flex-column align-items-center">
              <div class="category-buttons mx-4" id="category-buttons">
                  {% for category in categories %}
                  <button class="custom-card-button my-2" onclick="selectCategory('{{ category.id }}')">{{ category.category }}</button>
                  {% endfor %}
              </div>
          </div>
          <h2 class="text-center" id="subcategoryTitle" style="display: none;">{% trans 'Select a Subcategory' %}</h2>
          <div class="subcategory-buttons" id="subcategory-buttons" style="display: none;flex-direction: column; gap: 10px;">
              <!-- Subcategory buttons dynamically added here -->
          </div>
          <div class="chat-section p-1" id="chat-section">
              <div class="messages" id="messages">
                  <div class="message bot">{% trans 'botwelcome' %}</div>
              </div>
              <div class="input-bar" id="input-bar">
                  <form id="messageForm">
                      {% csrf_token %}
                      <input type="text" id="messageInput" placeholder="{% trans 'typeanswer' %}" />
                      <button class="custom-card-button" type="submit">{% trans 'send' %}</button>
                  </form>
              </div>
          </div>
      </div>
  </div>
</div>

        </div> <!-- .row -->
      </div> <!-- .col-12 -->
    </div> <!-- .row -->
  </div> <!-- .container-fluid -->
</main> <!-- main -->

<script>
  const categoriesjs = JSON.parse('{{ categories_json|escapejs }}');
  const subcategoriesjs = JSON.parse('{{ subcategories_json|escapejs }}');
  const lang = '{{ language|escapejs }}'
  function startChat() {
  document.getElementById('cover-container').style.display = 'none';
  document.getElementById('chat-content').style.display = 'block';
}

</script>

<script src="{% static 'chat/chat.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

{% endblock %}
